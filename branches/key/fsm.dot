digraph fsm
{
    edge[fontsize=10];
    //node[shape = box]; 

    DISCONNECTED;
    CONNECTING;
    DISCONNECTING;
    CONNECTED_WAIT_RANGE;
    CONNECTED;
    INSERTING_NEXT;
    PREVIOUS_LEAVING;

    DISCONNECTED -> CONNECTING [label = "run()"];
    DISCONNECTED -> CONNECTED [label = "recv(MsgConnect) && id == next"];
    CONNECTING -> CONNECTED_WAIT_RANGE [label = "send(MsgConnect(next))"];
    CONNECTED_WAIT_RANGE -> CONNECTED [label = "recv(MsgEndRange"];
    CONNECTED -> DISCONNECTING [label = "leave()"];
    DISCONNECTING -> DISCONNECTED [label = "send(MsgDisconnect(next))"];
    CONNECTED -> PREVIOUS_LEAVING [label = "recv(MsgData)"];
    PREVIOUS_LEAVING -> CONNECTED [label = "recv(MsgDisconnect)"];
    CONNECTED -> INSERTING_NEXT [label = "recv(MsgAsk())"];
    INSERTING_NEXT -> CONNECTED [label = "send(MsgEndOfRange)"];
};
